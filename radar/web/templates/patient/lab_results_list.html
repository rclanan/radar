{% extends 'patient/lab_results_base.html' %}

{% set current_lab_results_page = 'list' %}

{% from 'macros/pagination.html' import render_pagination %}
{% from 'macros/ordering.html' import render_sortable_column %}

{% block content %}
    {{ super() }}

    <p>
        <a href="{{ url_for('lab_results.add_lab_result', patient_id=patient.id) }}" class="btn btn-primary">New</a>
    </p>

    <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <th></th>
                <th>{{ render_sortable_column(ordering, 'date', 'Date') }}</th>
                <th>{{ render_sortable_column(ordering, 'group', 'Group') }}</th>
                <th>{{ render_sortable_column(ordering, 'result', 'Result') }}</th>
                <th>{{ render_sortable_column(ordering, 'value', 'Value') }}</th>
                <th>{{ render_sortable_column(ordering, 'units', 'Units') }}</th>
                <th>{{ render_sortable_column(ordering, 'source', 'Data Source') }}</th>
                <th></th>
            </tr>
        </thead>

        <tbody>
            {% for x in lab_results %}
                <tr>
                    <td>
                        {% if x.can_edit(current_user) %}
                            <a href="#" class="btn btn-primary btn-xs">Edit</a>
                        {% endif %}
                    </td>

                    <td>{{ x.lab_group.date | datetime_format("%d/%m/%Y %H:%M") }}</td>
                    <td>{{ x.lab_group.lab_group_definition.name }}</td>
                    <td>{{ x.lab_result_definition.name }}</td>
                    <td>{{ x.value }}</td>
                    <td>{{ x.lab_result_definition.units | missing }}</td>
                    <td>{{ x.lab_group.facility.name }}</td>
                    <td></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {{ render_pagination(pagination) }}
{% endblock %}