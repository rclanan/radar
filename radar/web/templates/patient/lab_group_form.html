{% extends 'patient/base.html' %}

{% set current_patient_page = 'lab_results' %}

{% from 'macros/forms.html' import render_horizontal_field as render_field %}
{% from 'macros/forms.html' import render_horizontal_button as render_button %}
{% from 'macros/lab_results.html' import render_lab_group_form %}

{% block content %}
    {% if object.id %}
        <h1 class="page-header">Edit Lab Result</h1>
    {% else %}
        <h1 class="page-header">New Lab Result</h1>
    {% endif %}

    {% if not object.id %}
        <form class="form-horizontal" method="POST">
            {{ select_form.hidden_tag() }}

            {{ render_field(select_form.lab_group_definition_id) }}

            {% call render_button() %}
                <button type="submit" class="btn btn-primary">Select</button>
            {% endcall %}
        </form>

        <hr />
    {% endif %}

    <div id="lab_group_form">
        {% if form %}
            {{ render_lab_group_form(object.lab_group_definition, form) }}
        {% else %}
            <p>Please choose a lab order above.</p>
        {% endif %}
    </div>
{% endblock %}

{% block body_js %}
    <script>
        $(function() {
            $('#lab_group_definition_id').change(function() {
                var lab_group_definition_id = $(this).val();
                var url = '../forms/' + lab_group_definition_id + '/';
                $.get(url, function(data) {
                    $('#lab_group_form').html(data);
                    init_datepickers();
                });
            });
        });
    </script>
{% endblock %}