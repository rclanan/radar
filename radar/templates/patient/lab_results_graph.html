{% extends 'patient/lab_results_base.html' %}

{% set current_lab_results_page = 'graph' %}

{% block content %}
    {{ super() }}

    {{ form.test_item(class='form-control') }}

    <div id="graph" style="width:100%; height:400px;"></div>
{% endblock %}

{% block body_js %}
    <script>
        function load_test_item(test_item) {
            $.get('data.json', {'test_item': test_item}, function(data) {
                var graphData = [];

                for (var i = 0; i < data.data.length; i++) {
                    var row = data.data[i];
                    var date = Date.parse(row[0]);
                    var value = row[1];
                    graphData.push([date, value]);
                }

                var options = {
                    chart: {
                        zoomType: 'x',
                        renderTo: 'graph'
                    },
                    title: {
                        text: data.name
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    yAxis: {
                        title: {
                            text: data.units
                        }
                    },
                    series: [{
                        name: data.name,
                        data: graphData
                    }],
                    plotOptions: {
                        line: {
                            marker: {
                                enabled: true
                            }
                        }
                    }
                };

                var chart = new Highcharts.Chart(options);
            });
        }

        $(function () {
            $("#test_item").change(function() {
                var test_item = $(this).val();
                load_test_item(test_item);
            }).trigger("change");
        });
    </script>
{% endblock %}